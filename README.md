# MQL 5 - MetaQuotes Language 5

- C++ syntax
  - `#include` header file like in C++
- custom trading functions
- custom event handler
- custom technical indicators

## Type of MQL5 Applications
- Expert Advisor
  - Automated trading system linked to chart
  - contains events handler to manage predefined events
  - `<Terminal_Directory>\MQL5\Experts`
- Custom indicators
  - to perform analytical analysis functions
  - display in price chart or in separate window below the price chart
  - trend following or oscillators
  - have buffers
  - `<Terminal_Directory>\MQL5\Indicators`
- Script
  - single executuion action
  - does not handle events
  - manually triggered
  - must contain `OnStart` handler function
  - `<Terminal_Directory>\MQL5\Scripts`
- Service
  - does not required to be bound to chart
  - does not handle events
  - manually triggered
  - `<Terminal_Directory>\MQL5\Services`
- Library 
  - set of custom functions
  - `<Terminal_Directory>\MQL5\Libraries`

## MQL5 vs C++
- no addressing
- no `goto` operator
- no anonymous `enum`
- no multiple inheritance

## MQL5 Basic Data Types
- integers - char | short | int | long | uchar | ushort | uint | ulong
- logical - bool
- literals - ushort
- string
- floating point - double | floating
- color
  - constant value
- datetime
  ```cpp
  datetime d1=D'1980.07.19 12:30:27'; 
  datetime d4=D'01.01.2004'; 
  ```
- enum
```
 enum name of enumerable type {
   list of values
 };
```

```cpp
enum months {
  January,
  February,
  March,
  April,
  May,
  June,
  July,
  August,
  September,
  October,
  November,
  December
}
```

```cpp
enum intervals {  // Enumeration of named constants
  month=1,     // Interval of one month
  two_months,  // Two months
  quarter,     // Three months - quarter
  halfyear=6,  // Half a year
  year=12,     // Year - 12 months
  };
```

- structures
- classes

## Basic Expert Advisor (EA)

```cpp
#property copyright "Copyright 2019, Noxasch"
#property link      "https://noxasch.tech"
#property version   "1.00"

int OnInit(){

  return(INIT_SUCCEEDED);
}


void OnDeinit(const int reason) {

}

void OnTick() {
   
}


```

```cpp
// declare program info
#property copyright   "Copyright 2019, Noxasch"
#property link        "url"
#property description "My Description"
#property version     "1.0.0"

// library header
#include <Expert\Expert.mqh>

// variable and input declaration (params block)

// events handler
int OnInit() {
  // execute when the scripts is loaded in MetaTrader
  // to init value or mapping
  // must return constant value or equivalent
  // return constant
  // INIT_SUCCEEDED - 0
  // INIT_FAILED
  // INIT_PARAMETERS_INCORRECT
  // INIT_AGENT_NOT_SUITABLE
  return(0); // euiv to return(INIT_SUCCEEDED)
}

void OnDeinit(const int reason) {
  // execute when EA is remove in MetaTrader
  // do cleanup
  // clear memory
  // clear screen
  Comment("");
}

void OnTick() {
  // execute whenenever MetaTrader receive new quotes from broker
  // only exist in EA
  // brain of the EA, most control of EA we do it here
}

void OnTimer() {
  // periodically generated by client terminal for EA
  // activated during OnInit using EventSetTimer() function
  // must be kill during OnDeinit() using EventKillTimer() function
  // only ONE timer is allowed per program
  // by default the timer interval is 1 second
  // to use timer with higher resolution use EventSetMiliSecondTimer()
  // minimum interval is 1000 miliseconds or 1 seconds
  // fo

}
```

### More Event Handler

- OnStart

```cpp
int OnStart(void) {
  // called in scripts and services only
  // called when a script or service is executed
  // intended for one time executoin of action
}
```
- OnCalculate
```cpp
int OnCalculate() {
  // called when Calculate events occurs for processing data changes
  // Calculate events generated only for indicators
}
```
- OnTrade
```cpp
void onTrade() {
    // called in EA when trade event occured
    // trade events: change active order, change positions, change deals, change trade history
    // order, cabkce irder, actiavtion of pending order
    // opening or closing a position
    // changing SL or TP
}
```
- OnTradeTransaction
- OnBookEvent
- OnChartEvent

### Common functions
- Alert
```cpp
// does not work in  Strategy Tester
//  Dates are output as YYYY.MM.DD HH:MI:SS
// To display a date in another format use the TimeToString() function
// max 64 params
Alert("Account Balance: ", myAccountBalance, "\n", "Account Profit: ", myAccountProfit, "\n", "Account Equity: ", myAccountEquity);
```
- Comment
```cpp
// show text on top left corner of a chart
Comment("Account Balance: ", myAccountBalance, "\n", "Account Profit: ", myAccountProfit, "\n", "Account Equity: ", myAccountEquity);

Comment(StringFormat("Show prices\nAsk = %G\nBid = %G\nSpread = %d",Ask,Bid,Spread)); 
```
- MessageBox
- PlaySound
- Print
- PrintFormat
- ExpertRemove
```cpp
  ExpertRemove(); // remove or unload EA
```
- sendNotifications
```cpp
// send push notifications to specified ID mobile terminal
// return True if notification is send
// 4515 – ERR_NOTIFICATION_SEND_FAILED,
// 4516 – ERR_NOTIFICATION_WRONG_PARAMETER,
// 4517 – ERR_NOTIFICATION_WRONG_SETTINGS,
// 4518 – ERR_NOTIFICATION_TOO_FREQUENT.
// does not work in strategy tester
sendNotification("text");
```

### Built-in Indicators function

- iMA() - Moving Average to save to handle
- CopyBuffer() - to store buffer from handle
- CopyClose() - get price chart close price buffer


### Built-in Library, Usage and How to use

- Trade.mqh - for trade execution
- PositionInfo.mqh - obtain information on positions

### Standard Library
- are stored in Include/NAME
  - Trade\Trade - to placed and modify order
  - Trade\PositionIndo - get information about existing positions
  - Trade\OrderInfo - working with orders or pending order

```cpp
#include <Trade\Trade.mqh>
#include <Trade\PositionInfo.mqh>

CTrade m_Trade; // trade object
m_Trade.Sell(lot, symbol_name, price, sl, tp, comment); 
// lot - order size is the only mandatory

// close all position
CPosition m_Position;
m_Position.Select(symbol_name);
m_Trade.PositionClose(symbol_name); // close whole position

// close position by reverse order of the same size
m_Trade.Buy(lot, symbol_name, price, sl, tp, comment);

```


### building a basic indicator

- indicator buffer
  - array where the first element (index 0) carries data from the rightmost CS and the following element is index 1. the arrangement are called Time Series

1. define currency pair (String symbol) and time frame
2. 

Handle
- to hold the indicator

```cpp
int iMA_handle;
iMA_handle = iMA("EURUSD", PERIOD_H1, 10, 0, MODE_SMA, PRICE_CLOSE);
// iMA(string symbol, int timeframe, int ma_period, int ma_shift, int ma_method, int applied_price, int shift)
// iMA = Moving Average indicator
```

## References

1. [A Quick Start Or a Short Guide for Beginners](https://www.mql5.com/en/articles/496)
2. [Step-By-Step Guide to writing an Expert Advisor in MQL5 for Beginners](https://www.mql5.com/en/articles/100)


